<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <!-- CSP temporarily disabled for Stripe.js compatibility -->
    <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://js.stripe.com https://api.stripe.com https://hooks.stripe.com https://checkout.stripe.com https://fonts.googleapis.com https://fonts.gstatic.com https://api.openai.com; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://js.stripe.com https://api.stripe.com https://hooks.stripe.com https://checkout.stripe.com https://replit.com blob:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; connect-src 'self' https://api.stripe.com https://hooks.stripe.com https://checkout.stripe.com https://api.openai.com ws: wss:; frame-src 'self' https://js.stripe.com https://hooks.stripe.com https://checkout.stripe.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com;"> -->
    <title>Adaptalyfe - Grow with Guidance. Thrive with Confidence.</title>
    <link rel="stylesheet" href="/force-hide-errors.css">
    <script src="/block-error-modal.js?v=2"></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="description" content="Adaptalyfe - Grow with Guidance. Thrive with Confidence. Helping individuals with developmental disabilities build independence through daily task management, financial planning, mood tracking, and comprehensive support features." />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#22c55e" />
    <link rel="icon" href="/icon-192.png" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Adaptalyfe" />
    
    <!-- Mobile Debug Script -->
    <script>
      // Mobile debugging
      window.addEventListener('error', function(e) {
        console.error('Mobile Error:', e.error, e.filename, e.lineno);
        document.body.innerHTML = '<div style="padding:20px;font-family:Arial;color:red;"><h2>Mobile Error Detected</h2><p>Error: ' + e.error + '</p><p>File: ' + e.filename + '</p><p>Line: ' + e.lineno + '</p></div>';
      });
      
      // Log mobile detection
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      console.log('Mobile detected:', isMobile, 'User agent:', navigator.userAgent);
      
      // Login redirect fix
      window.addEventListener('message', function(event) {
        if (event.data && event.data.type === 'LOGIN_SUCCESS') {
          console.log('Login success detected, redirecting to dashboard...');
          setTimeout(() => {
            window.location.href = '/dashboard';
          }, 500);
        }
      });
      
      // Manual login success detection
      let checkLoginSuccess = setInterval(function() {
        if (window.location.pathname === '/login' && document.querySelector('[data-login-success]')) {
          console.log('Manual redirect to dashboard after login success');
          clearInterval(checkLoginSuccess);
          setTimeout(() => {
            window.location.href = '/dashboard';
          }, 1000);
        }
      }, 500);
      
      // Global login success handler for React components
      window.handleLoginSuccess = function(response) {
        console.log('Global login success handler triggered', response);
        if (response && response.success) {
          const redirectUrl = response.redirect || '/dashboard';
          console.log('Redirecting to:', redirectUrl);
          setTimeout(() => {
            window.location.href = redirectUrl;
          }, 500);
        }
      };
      
      // Listen for successful fetch responses to login endpoint
      const originalFetch = window.fetch;
      window.fetch = function(...args) {
        return originalFetch.apply(this, args).then(response => {
          if (response.url && response.url.includes('/api/auth/login') && response.ok) {
            response.clone().json().then(data => {
              if (data.success) {
                console.log('Login API success detected, triggering redirect');
                window.handleLoginSuccess(data);
              }
            }).catch(() => {});
          }
          return response;
        });
      };
      
      // Service Worker Registration (commented out for mobile debugging)
      /*
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
              console.log('SW registered: ', registration);
            })
            .catch((registrationError) => {
              console.log('SW registration failed: ', registrationError);
            });
        });
      }
      */
    </script>
    <script type="module" crossorigin src="/assets/index-CdgTcnaq.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-BpAM9bFg.css">
  </head>
  <body>
    <div id="root"></div>
    <!-- This is a replit script which adds a banner on the top of the page when opened in development mode outside the replit environment -->
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>